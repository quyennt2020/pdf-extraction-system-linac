<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ontology Expert Review Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/dashboard.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-project-diagram me-2"></i>
                Ontology Expert Review
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user me-1"></i>
                    Expert Dashboard
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#overview" data-tab="overview">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Overview
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#entities" data-tab="entities">
                                <i class="fas fa-cubes me-2"></i>
                                Entity Review
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#relationships" data-tab="relationships">
                                <i class="fas fa-share-alt me-2"></i>
                                Relationships
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#visualization" data-tab="visualization">
                                <i class="fas fa-project-diagram me-2"></i>
                                Ontology Graph
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#bulk-edit" data-tab="bulk-edit">
                                <i class="fas fa-edit me-2"></i>
                                Bulk Edit
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content active">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Dashboard Overview</h1>
                        <div class="btn-group">
                            <button class="btn btn-outline-success" onclick="loadPdfResults()">
                                <i class="fas fa-file-pdf me-1"></i>
                                Load PDF Results
                            </button>
                            <button class="btn btn-outline-info" onclick="showImportModal()">
                                <i class="fas fa-upload me-1"></i>
                                Import Data
                            </button>
                            <button class="btn btn-outline-danger" onclick="clearData()">
                                <i class="fas fa-trash me-1"></i>
                                Clear Data
                            </button>
                            <button class="btn btn-outline-primary" onclick="refreshOverview()">
                                <i class="fas fa-sync-alt me-1"></i>
                                Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="total-entities">0</h4>
                                            <p class="mb-0">Total Entities</p>
                                        </div>
                                        <i class="fas fa-cubes fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="pending-review">0</h4>
                                            <p class="mb-0">Pending Review</p>
                                        </div>
                                        <i class="fas fa-clock fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="approved-entities">0</h4>
                                            <p class="mb-0">Approved</p>
                                        </div>
                                        <i class="fas fa-check fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="total-relationships">0</h4>
                                            <p class="mb-0">Relationships</p>
                                        </div>
                                        <i class="fas fa-share-alt fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Validation Status Chart -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Validation Status Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="validation-chart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Entity Type Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="entity-type-chart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>         
       <!-- Entity Review Tab -->
                <div id="entities-tab" class="tab-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Entity Review</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <select class="form-select" id="entity-type-filter">
                                    <option value="">All Types</option>
                                    <option value="system">Systems</option>
                                    <option value="subsystem">Subsystems</option>
                                    <option value="component">Components</option>
                                    <option value="spare_part">Spare Parts</option>
                                </select>
                            </div>
                            <div class="btn-group me-2">
                                <select class="form-select" id="validation-status-filter">
                                    <option value="">All Statuses</option>
                                    <option value="not_validated">Not Validated</option>
                                    <option value="pending_review">Pending Review</option>
                                    <option value="expert_approved">Approved</option>
                                    <option value="expert_rejected">Rejected</option>
                                    <option value="needs_revision">Needs Revision</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="loadEntities()">
                                <i class="fas fa-search me-1"></i>
                                Filter
                            </button>
                        </div>
                    </div>

                    <!-- Entity List -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="select-all-entities">
                                            </th>
                                            <th>Image</th>
                                            <th>Label</th>
                                            <th>Type</th>
                                            <th>Confidence</th>
                                            <th>Status</th>
                                            <th>Last Modified</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="entities-table-body">
                                        <!-- Entities will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <nav aria-label="Entity pagination">
                                <ul class="pagination justify-content-center" id="entities-pagination">
                                    <!-- Pagination will be generated here -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Relationships Tab -->
                <div id="relationships-tab" class="tab-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Relationship Editor</h1>
                        <button class="btn btn-success" onclick="showCreateRelationshipModal()">
                            <i class="fas fa-plus me-1"></i>
                            Create Relationship
                        </button>
                    </div>

                    <!-- Relationship Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <select class="form-select" id="relationship-type-filter">
                                <option value="">All Relationship Types</option>
                                <option value="has_subsystem">Has Subsystem</option>
                                <option value="has_component">Has Component</option>
                                <option value="part_of">Part Of</option>
                                <option value="controls">Controls</option>
                                <option value="monitors">Monitors</option>
                                <option value="causes">Causes</option>
                                <option value="requires">Requires</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="source-entity-filter" placeholder="Source Entity ID">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary" onclick="loadRelationships()">
                                <i class="fas fa-search me-1"></i>
                                Filter Relationships
                            </button>
                        </div>
                    </div>

                    <!-- Relationships List -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Relationship Type</th>
                                            <th>Source Entity</th>
                                            <th>Target Entity</th>
                                            <th>Description</th>
                                            <th>Confidence</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="relationships-table-body">
                                        <!-- Relationships will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization Tab -->
                <div id="visualization-tab" class="tab-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Ontology Visualization</h1>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary" onclick="refreshVisualization()">
                                <i class="fas fa-sync-alt me-1"></i>
                                Refresh
                            </button>
                            <button class="btn btn-outline-secondary" onclick="exportVisualization()">
                                <i class="fas fa-download me-1"></i>
                                Export
                            </button>
                        </div>
                    </div>

                    <!-- Visualization Controls -->
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Layout</label>
                            <select class="form-select" id="layout-select">
                                <option value="hierarchical">Hierarchical</option>
                                <option value="force">Force-directed</option>
                                <option value="circular">Circular</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Show Entity Types</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="show-systems" checked>
                                <label class="form-check-label">Systems</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="show-subsystems" checked>
                                <label class="form-check-label">Subsystems</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="show-components" checked>
                                <label class="form-check-label">Components</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="show-spare-parts">
                                <label class="form-check-label">Spare Parts</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary mt-4" onclick="updateVisualization()">
                                Update View
                            </button>
                        </div>
                    </div>

                    <!-- Visualization Statistics -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Graph Statistics</h6>
                        </div>
                        <div class="card-body">
                            <div id="visualization-stats">
                                <!-- Statistics will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Container -->
                    <div class="card">
                        <div class="card-body">
                            <div id="ontology-network" style="height: 600px; border: 1px solid #ddd;"></div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Edit Tab -->
                <div id="bulk-edit-tab" class="tab-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Bulk Edit Operations</h1>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Selected Entities</h5>
                                </div>
                                <div class="card-body">
                                    <div id="selected-entities-list">
                                        <p class="text-muted">No entities selected. Use the Entity Review tab to select entities for bulk editing.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Bulk Operations</h5>
                                </div>
                                <div class="card-body">
                                    <form id="bulk-edit-form">
                                        <div class="mb-3">
                                            <label class="form-label">Operation Type</label>
                                            <select class="form-select" id="bulk-operation-type">
                                                <option value="validate">Validate Entities</option>
                                                <option value="reject">Reject Entities</option>
                                                <option value="update-metadata">Update Metadata</option>
                                                <option value="add-tags">Add Tags</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Expert Comment</label>
                                            <textarea class="form-control" id="bulk-comment" rows="3" placeholder="Enter comment for this bulk operation..."></textarea>
                                        </div>
                                        <div class="mb-3" id="bulk-operation-fields">
                                            <!-- Dynamic fields based on operation type -->
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-1"></i>
                                            Apply Bulk Operation
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div> 
   <!-- Modals -->
    
    <!-- Entity Details Modal -->
    <div class="modal fade" id="entityDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Entity Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="entity-details-content">
                    <!-- Entity details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="approveEntity()">
                        <i class="fas fa-check me-1"></i>
                        Approve
                    </button>
                    <button type="button" class="btn btn-danger" onclick="rejectEntity()">
                        <i class="fas fa-times me-1"></i>
                        Reject
                    </button>
                    <button type="button" class="btn btn-primary" onclick="editCurrentEntity()">
                        <i class="fas fa-edit me-1"></i>
                        Edit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Entity Edit Modal -->
    <div class="modal fade" id="entityEditModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>
                        Edit Entity
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Entity Form -->
                        <div class="col-md-8">
                            <form id="entity-edit-form">
                                <input type="hidden" id="edit-entity-id">
                                <input type="hidden" id="edit-entity-type">
                                
                                <!-- Basic Information -->
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h6 class="mb-0">Basic Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Label <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="edit-label" required>
                                                    <div class="invalid-feedback"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Entity Type</label>
                                                    <input type="text" class="form-control" id="edit-type-display" readonly>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-control" id="edit-description" rows="3"></textarea>
                                            <div class="invalid-feedback"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Entity Image -->
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h6 class="mb-0">Entity Image</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Upload Image</label>
                                                    <input type="file" class="form-control" id="entity-image-upload" accept="image/*">
                                                    <div class="form-text">Supported formats: JPEG, PNG, GIF, WebP (Max 5MB)</div>
                                                </div>
                                                <button type="button" class="btn btn-primary btn-sm" onclick="uploadEntityImage()">
                                                    <i class="fas fa-upload me-1"></i>
                                                    Upload Image
                                                </button>
                                                <button type="button" class="btn btn-outline-danger btn-sm ms-2" onclick="deleteEntityImage()" id="delete-image-btn" style="display: none;">
                                                    <i class="fas fa-trash me-1"></i>
                                                    Delete Image
                                                </button>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="text-center">
                                                    <div id="entity-image-preview" style="display: none;">
                                                        <img id="entity-image-display" src="" alt="Entity Image" class="img-fluid rounded" style="max-height: 200px;">
                                                    </div>
                                                    <div id="no-image-placeholder" class="text-muted">
                                                        <i class="fas fa-image fa-3x mb-2"></i>
                                                        <p>No image uploaded</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Type-specific Fields -->
                                <div class="card mb-3" id="type-specific-fields">
                                    <div class="card-header">
                                        <h6 class="mb-0">Specific Properties</h6>
                                    </div>
                                    <div class="card-body" id="type-specific-content">
                                        <!-- Content will be dynamically generated -->
                                    </div>
                                </div>
                                
                                <!-- Metadata -->
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h6 class="mb-0">Metadata & Validation</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Confidence Score</label>
                                                    <div class="input-group">
                                                        <input type="range" class="form-range" id="edit-confidence" 
                                                               min="0" max="1" step="0.01">
                                                        <span class="input-group-text" id="confidence-display">0.00</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Validation Status</label>
                                                    <select class="form-select" id="edit-validation-status">
                                                        <option value="not_validated">Not Validated</option>
                                                        <option value="pending_review">Pending Review</option>
                                                        <option value="expert_approved">Expert Approved</option>
                                                        <option value="expert_rejected">Expert Rejected</option>
                                                        <option value="needs_revision">Needs Revision</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tags</label>
                                            <input type="text" class="form-control" id="edit-tags" 
                                                   placeholder="Enter tags separated by commas">
                                            <div class="form-text">Separate multiple tags with commas</div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Validation Panel -->
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Validation Status
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="validation-issues">
                                        <!-- Validation issues will be displayed here -->
                                    </div>
                                    
                                    <div class="mt-3">
                                        <button type="button" class="btn btn-outline-primary btn-sm w-100" 
                                                onclick="validateCurrentEntity()">
                                            <i class="fas fa-sync me-1"></i>
                                            Re-validate
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-history me-1"></i>
                                        Review History
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="review-history">
                                        <!-- Review history will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="saveAsDraft()">
                        <i class="fas fa-save me-1"></i>
                        Save as Draft
                    </button>
                    <button type="button" class="btn btn-success" onclick="saveAndApprove()">
                        <i class="fas fa-check me-1"></i>
                        Save & Approve
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveEntity()">
                        <i class="fas fa-save me-1"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Relationship Modal -->
    <div class="modal fade" id="createRelationshipModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Relationship</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="create-relationship-form">
                        <div class="mb-3">
                            <label class="form-label">Relationship Type</label>
                            <select class="form-select" id="new-relationship-type" required>
                                <option value="">Select relationship type...</option>
                                <option value="has_subsystem">Has Subsystem</option>
                                <option value="has_component">Has Component</option>
                                <option value="part_of">Part Of</option>
                                <option value="controls">Controls</option>
                                <option value="monitors">Monitors</option>
                                <option value="causes">Causes</option>
                                <option value="requires">Requires</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Source Entity ID</label>
                            <input type="text" class="form-control" id="new-source-entity" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Target Entity ID</label>
                            <input type="text" class="form-control" id="new-target-entity" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="new-relationship-description" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createRelationship()">
                        <i class="fas fa-plus me-1"></i>
                        Create Relationship
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal fade" id="importDataModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-upload me-2"></i>
                        Import Entity Data
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <!-- Import Options -->
                            <div class="mb-4">
                                <h6>Import Mode</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="importMode" id="importMerge" value="merge" checked>
                                    <label class="form-check-label" for="importMerge">
                                        <strong>Merge</strong> - Add new entities, skip duplicates
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="importMode" id="importAppend" value="append">
                                    <label class="form-check-label" for="importAppend">
                                        <strong>Append</strong> - Add all entities, allow duplicates
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="importMode" id="importReplace" value="replace">
                                    <label class="form-check-label" for="importReplace">
                                        <strong>Replace</strong> - Clear existing data and import new
                                    </label>
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div class="mb-4">
                                <h6>Select JSON File</h6>
                                <input type="file" class="form-control" id="importFile" accept=".json" onchange="handleFileSelect(event)">
                                <div class="form-text">
                                    Upload a JSON file containing entities and relationships data.
                                    <a href="#" onclick="showImportFormat()">View expected format</a>
                                </div>
                            </div>

                            <!-- File Preview -->
                            <div id="filePreview" class="mb-4" style="display: none;">
                                <h6>File Preview</h6>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <small class="text-muted">Entities found:</small>
                                                <div id="previewEntities" class="fw-bold">0</div>
                                            </div>
                                            <div class="col-md-6">
                                                <small class="text-muted">Relationships found:</small>
                                                <div id="previewRelationships" class="fw-bold">0</div>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-info" onclick="validateImport()">
                                                <i class="fas fa-check-circle me-1"></i>
                                                Validate Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Validation Results -->
                            <div id="validationResults" class="mb-4" style="display: none;">
                                <h6>Validation Results</h6>
                                <div id="validationContent"></div>
                            </div>

                            <!-- Import Progress -->
                            <div id="importProgress" class="mb-4" style="display: none;">
                                <h6>Import Progress</h6>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="mt-2">
                                    <small id="progressText">Preparing import...</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-info" id="validateBtn" onclick="validateImport()" disabled>
                        <i class="fas fa-check-circle me-1"></i>
                        Validate
                    </button>
                    <button type="button" class="btn btn-success" id="importBtn" onclick="performImport()" disabled>
                        <i class="fas fa-upload me-1"></i>
                        Import Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Format Help Modal -->
    <div class="modal fade" id="importFormatModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-info-circle me-2"></i>
                        Import Data Format
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>The import file should be a JSON file with the following structure:</p>
                    <pre class="bg-light p-3 rounded"><code>{
  "entities": [
    {
      "entity_type": "component",
      "label": "Multi-Leaf Collimator",
      "description": "120-leaf collimator for beam shaping",
      "component_type": "Collimator",
      "part_number": "MLC-120",
      "manufacturer": "Varian",
      "metadata": {
        "confidence_score": 0.9,
        "validation_status": "pending_review"
      }
    }
  ],
  "relationships": [
    {
      "relationship_type": "has_component",
      "source_entity_id": "system_id",
      "target_entity_id": "component_id",
      "description": "System contains component"
    }
  ]
}</code></pre>
                    <h6 class="mt-4">Entity Types</h6>
                    <ul>
                        <li><code>system</code> - Top-level medical device systems</li>
                        <li><code>subsystem</code> - Functional subsystems</li>
                        <li><code>component</code> - Individual components</li>
                        <li><code>spare_part</code> - Replaceable parts</li>
                    </ul>
                    <h6 class="mt-3">Validation Status Options</h6>
                    <ul>
                        <li><code>not_validated</code></li>
                        <li><code>pending_review</code></li>
                        <li><code>expert_approved</code></li>
                        <li><code>expert_rejected</code></li>
                        <li><code>needs_revision</code></li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Entity Forms -->
    {% include 'entity_forms.html' %}
    
    <!-- Include Relationship Editor -->
    {% include 'relationship_editor.html' %}

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/entity_validation.js"></script>
    <script src="/static/js/relationship_editor.js"></script>
</body>
</html>